name: "Deploy to dokku"

on:
    release:
        types:
            - created

    workflow_dispatch:

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Cancel Previous Runs
              uses: styfle/cancel-workflow-action@0.9.1
              with:
                  access_token: ${{ github.token }}

            - name: Cloning repo
              uses: actions/checkout@v2.3.4
              with:
                  fetch-depth: 0
                  ref: master

            - name: Deploy to dokku
              uses: vitalyliber/dokku-github-action@v6.2
              env:
                  PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
                  FORCE_DEPLOY: true
                  BRANCH: master
                  HOST: ${{ secrets.HOST }}
                  PROJECT: crackwatch2
